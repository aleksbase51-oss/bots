# modules/lessons_module.py
from aiogram import Router, types
from aiogram.filters import Command
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
import logging
from datetime import datetime
import sys
import os

from core.module_manager import register_module

logger = logging.getLogger(__name__)
router = Router()

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
try:
    from shared.local_database import local_db
    HAS_DATABASE = True
    print("‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –º–æ–¥—É–ª—è lessons")
except ImportError as e:
    print(f"‚ö†Ô∏è –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞: {e}")
    HAS_DATABASE = False

# –°–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω—ã–µ —É—Ä–æ–∫–∏ –ø—Ä—è–º–æ –∑–¥–µ—Å—å
LESSONS = [
    {
        "id": 1,
        "title": "–ß—Ç–æ —Ç–∞–∫–æ–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ –∏ –±–ª–æ–∫—á–µ–π–Ω",
        "content": """
üèõÔ∏è **–£—Ä–æ–∫ 1: –ß—Ç–æ —Ç–∞–∫–æ–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ –∏ –±–ª–æ–∫—á–µ–π–Ω**

**–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞** ‚Äî —ç—Ç–æ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –¥–µ–Ω—å–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ–±—ã—á–Ω—ã—Ö –¥–µ–Ω–µ–≥, –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –±–∞–Ω–∫–∞–º–∏ –∏–ª–∏ –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏.

**–ë–ª–æ–∫—á–µ–π–Ω** ‚Äî —ç—Ç–æ —Ü–µ–ø–æ—á–∫–∞ –±–ª–æ–∫–æ–≤ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö. –ö–∞–∂–¥—ã–π –±–ª–æ–∫ —Å–≤—è–∑–∞–Ω —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º, —Å–æ–∑–¥–∞–≤–∞—è –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—É—é –∏—Å—Ç–æ—Ä–∏—é.

üéØ **–ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è:**
‚Ä¢ –î–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –Ω–µ—Ç –µ–¥–∏–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚Ä¢ –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å ‚Äî –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∏–¥–Ω—ã –≤ —Å–µ—Ç–∏
‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π

üí° **–ü—Ä–∏–º–µ—Ä:** –ë–∏—Ç–∫–æ–∏–Ω (Bitcoin) ‚Äî –ø–µ—Ä–≤–∞—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –≤ 2009 –≥–æ–¥—É.
        """,
        "reward_spw": 10,
        "duration_minutes": 5
    },
    {
        "id": 2,
        "title": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞—â–∏—Ç–∏—Ç—å –∫–æ—à–µ–ª—ë–∫",
        "content": """
üîê **–£—Ä–æ–∫ 2: –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞—â–∏—Ç–∏—Ç—å –∫–æ—à–µ–ª—ë–∫**

**–ö—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª—ë–∫** ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è, –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç. –û–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –∫–ª—é—á–µ–π:

üîë **–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á** ‚Äî –≤–∞—à –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ (–º–æ–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ–º)
üîí **–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á** ‚Äî –≤–∞—à –ø–∞—Ä–æ–ª—å (–ù–ò–ö–û–ú–£ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å!)

üéØ **–¢–∏–ø—ã –∫–æ—à–µ–ª—å–∫–æ–≤:**
‚Ä¢ –ì–æ—Ä—è—á–∏–µ ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É (Telegram Wallet, Tonkeeper)
‚Ä¢ –•–æ–ª–æ–¥–Ω—ã–µ ‚Äî –æ—Ñ–ª–∞–π–Ω (–∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏, –±—É–º–∞–∂–Ω—ã–µ)

üö® **–ü—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
1. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–µ–ª–∏—Ç–µ—Å—å seed-—Ñ—Ä–∞–∑–æ–π (12-24 —Å–ª–æ–≤–∞)
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
3. –î–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ seed-—Ñ—Ä–∞–∑—ã
4. –û—Å—Ç–µ—Ä–µ–≥–∞–π—Ç–µ—Å—å —Ñ–∏—à–∏–Ω–≥–æ–≤—ã—Ö —Å–∞–π—Ç–æ–≤

üí° **–°–æ–≤–µ—Ç:** TON-–∫–æ—à–µ–ª—å–∫–∏ (–∫–∞–∫ –≤ —ç—Ç–æ–º –±–æ—Ç–µ) –±–µ–∑–æ–ø–∞—Å–Ω—ã, –Ω–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ —Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–ª—å–∫–æ —É —Å–µ–±—è.
        """,
        "reward_spw": 20,
        "duration_minutes": 7
    },
    {
        "id": 3,
        "title": "–ö–∞–∫ –∫—É–ø–∏—Ç—å –∏ –ø—Ä–æ–¥–∞—Ç—å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É",
        "content": """
üí∞ **–£—Ä–æ–∫ 3: –ö–∞–∫ –∫—É–ø–∏—Ç—å –∏ –ø—Ä–æ–¥–∞—Ç—å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É**

**–ö—É–ø–∏—Ç—å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É** –º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:

1. **–ö—Ä–∏–ø—Ç–æ–±–∏—Ä–∂–∏** (Binance, Bybit, OKX) ‚Äî –ø–æ–∫—É–ø–∞–µ—Ç–µ –∑–∞ —Ñ–∏–∞—Ç–Ω—ã–µ –¥–µ–Ω—å–≥–∏
2. **P2P-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã** ‚Äî –ø–æ–∫—É–ø–∞–µ—Ç–µ —É –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **–ö—Ä–∏–ø—Ç–æ–º–∞—Ç—ã** ‚Äî –∫–∞–∫ –±–∞–Ω–∫–æ–º–∞—Ç—ã, –Ω–æ –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
4. **–û–±–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã** ‚Äî –±—ã—Å—Ç—Ä—ã–π –æ–±–º–µ–Ω –º–µ–∂–¥—É –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º–∏

üéØ **–ö–∞–∫ –Ω–∞—á–∞—Ç—å:**
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –±–∏—Ä–∂–µ
2. –ü—Ä–æ–π–¥–∏—Ç–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é (KYC)
3. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç–æ–π –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–º
4. –ö—É–ø–∏—Ç–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É (TON, BTC, ETH)
5. –í—ã–≤–µ–¥–∏—Ç–µ –Ω–∞ —Å–≤–æ–π –∫–æ—à–µ–ª—ë–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

üìä **–¢–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã:**
‚Ä¢ TON/USDT ‚Äî –ø–æ–∫—É–ø–∞–µ–º TON –∑–∞ —Å—Ç–µ–π–±–ª–∫–æ–∏–Ω USDT
‚Ä¢ BTC/TON ‚Äî –æ–±–º–µ–Ω–∏–≤–∞–µ–º –±–∏—Ç–∫–æ–∏–Ω –Ω–∞ TON
‚Ä¢ SPW/TON ‚Äî –ø–æ–∫—É–ø–∞–µ–º SPW –∑–∞ TON (–Ω–∞ STON.fi)

üí° **–°–æ–≤–µ—Ç:** –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –Ω–µ–±–æ–ª—å—à–∏—Ö —Å—É–º–º –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–∏–º–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞.
        """,
        "reward_spw": 30,
        "duration_minutes": 8
    },
    {
        "id": 4,
        "title": "–ü—Ä–∏–Ω—Ü–∏–ø—ã –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏",
        "content": """
üìä **–£—Ä–æ–∫ 4: –ü—Ä–∏–Ω—Ü–∏–ø—ã –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏**

**–î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è** ‚Äî —ç—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∞–∫—Ç–∏–≤–∞–º–∏, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å —Ä–∏—Å–∫–∏.

üéØ **–ó–∞—á–µ–º –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å:**
‚Ä¢ –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤ ‚Äî –µ—Å–ª–∏ –æ–¥–∏–Ω –∞–∫—Ç–∏–≤ —É–ø–∞–¥—ë—Ç, –¥—Ä—É–≥–∏–µ –º–æ–≥—É—Ç –≤—ã—Ä–∞—Å—Ç–∏
‚Ä¢ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è ‚Äî –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ä–æ—Å—Ç–æ–º –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å—é
‚Ä¢ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–æ—Å—Ç–∞ ‚Äî —É—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–∞—Ö

üìà **–£—Ä–æ–≤–Ω–∏ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
1. **–ú–µ–∂–¥—É –∞–∫—Ç–∏–≤–∞–º–∏** ‚Äî TON, SPW, BTC, ETH
2. **–ú–µ–∂–¥—É —Å–µ–∫—Ç–æ—Ä–∞–º–∏** ‚Äî DeFi, NFT, GameFi, AI
3. **–ú–µ–∂–¥—É —Å–µ—Ç—è–º–∏** ‚Äî TON, Ethereum, Solana
4. **–ú–µ–∂–¥—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ, —Å—Ç–µ–π–∫–∏–Ω–≥, —Ç–æ—Ä–≥–æ–≤–ª—è

üìâ **–ü—Ä–∞–≤–∏–ª–æ: '–ù–µ –∫–ª–∞—Å—Ç—å –≤—Å–µ —è–π—Ü–∞ –≤ –æ–¥–Ω—É –∫–æ—Ä–∑–∏–Ω—É'**

–ü—Ä–∏–º–µ—Ä –ø–ª–æ—Ö–æ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è: 100% –≤ –æ–¥–Ω–æ–º —Ç–æ–∫–µ–Ω–µ
–ü—Ä–∏–º–µ—Ä —Ö–æ—Ä–æ—à–µ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è: 50% TON, 30% SPW, 10% BTC, 10% USDT

üí° **–°–æ–≤–µ—Ç:** –≠—Ç–æ—Ç –±–æ—Ç –ø–æ–º–æ–∂–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –≤–∞—à–µ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è!
        """,
        "reward_spw": 40,
        "duration_minutes": 6
    },
    {
        "id": 5,
        "title": "–°—Ç–µ–π–±–ª–∫–æ–∏–Ω—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",
        "content": """
üõ°Ô∏è **–£—Ä–æ–∫ 5: –°—Ç–µ–π–±–ª–∫–æ–∏–Ω—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

**–°—Ç–µ–π–±–ª–∫–æ–∏–Ω—ã** ‚Äî —ç—Ç–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ —Ñ–∏–∞—Ç–Ω—ã–º –¥–µ–Ω—å–≥–∞–º (–¥–æ–ª–ª–∞—Ä, –µ–≤—Ä–æ). –ò—Ö —Ü–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞.

üéØ **–¢–∏–ø—ã —Å—Ç–µ–π–±–ª–∫–æ–∏–Ω–æ–≤:**
‚Ä¢ –§–∏–∞—Ç–Ω–æ-–æ–±–µ—Å–ø–µ—á–µ–Ω–Ω—ã–µ (USDT, USDC) ‚Äî –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω—ã –¥–æ–ª–ª–∞—Ä–∞–º–∏ –≤ –±–∞–Ω–∫–µ
‚Ä¢ –ö—Ä–∏–ø—Ç–æ-–æ–±–µ—Å–ø–µ—á–µ–Ω–Ω—ã–µ (DAI) ‚Äî –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω—ã –¥—Ä—É–≥–∏–º–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º–∏
‚Ä¢ –ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–µ ‚Äî —Ä–µ–≥—É–ª–∏—Ä—É—é—Ç—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –±–µ–∑ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è

üîí **–û—Å–Ω–æ–≤—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
1. **Seed-—Ñ—Ä–∞–∑–∞** ‚Äî —Ö—Ä–∞–Ω–∏—Ç–µ –≤ –Ω–∞–¥—ë–∂–Ω–æ–º –º–µ—Å—Ç–µ, –ª—É—á—à–µ –æ—Ñ–ª–∞–π–Ω
2. **2FA** ‚Äî –≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–π—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥—Ä–µ—Å–æ–≤** ‚Äî –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∞–¥—Ä–µ—Å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
4. **–ê–Ω—Ç–∏—Ñ–∏—à–∏–Ω–≥** ‚Äî –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –ø–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º —Å—Å—ã–ª–∫–∞–º
5. **–•–æ–ª–æ–¥–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** ‚Äî –±–æ–ª—å—à–∏–µ —Å—É–º–º—ã —Ö—Ä–∞–Ω–∏—Ç–µ –Ω–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–∞—Ö

üö® **–ß–µ–≥–æ –ù–ï –¥–µ–ª–∞—Ç—å:**
‚Ä¢ –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ seed-—Ñ—Ä–∞–∑—É –≤ –æ–±–ª–∞–∫–µ –∏–ª–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
‚Ä¢ –ù–µ –≤–≤–æ–¥–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –Ω–∞ —Å–∞–π—Ç–∞—Ö
‚Ä¢ –ù–µ –¥–æ–≤–µ—Ä—è–π—Ç–µ '–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π' –ø—Ä–∏–±—ã–ª–∏
‚Ä¢ –ù–µ –∏–Ω–≤–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–æ–ª—å—à–µ, —á–µ–º –≥–æ—Ç–æ–≤—ã –ø–æ—Ç–µ—Ä—è—Ç—å

üí° **–§–∏–ª–æ—Å–æ—Ñ–∏—è –û–ú–†:** –û–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–≤–µ—Å—Ç–æ—Ä ‚Äî —É—Å–ø–µ—à–Ω—ã–π –∏–Ω–≤–µ—Å—Ç–æ—Ä!
        """,
        "reward_spw": 50,
        "duration_minutes": 10
    }
]

QUIZZES = {
    1: [
        {"question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞?", "options": ["–¶–∏—Ñ—Ä–æ–≤—ã–µ –¥–µ–Ω—å–≥–∏, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ –±–∞–Ω–∫–∞–º–∏", "–¶–∏—Ñ—Ä–æ–≤—ã–µ –¥–µ–Ω—å–≥–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏", "–û–±—ã—á–Ω—ã–µ –¥–µ–Ω—å–≥–∏ –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–º –≤–∏–¥–µ", "–ê–∫—Ü–∏–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π"], "correct": 1, "explanation": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ ‚Äî —ç—Ç–æ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –¥–µ–Ω—å–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç—Å—è –±–∞–Ω–∫–∞–º–∏ –∏–ª–∏ –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏."},
        {"question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –±–ª–æ–∫—á–µ–π–Ω?", "options": ["–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, —Ö—Ä–∞–Ω—è—â–∞—è—Å—è –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ", "–¶–µ–ø–æ—á–∫–∞ –±–ª–æ–∫–æ–≤ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö", "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã", "–¢–∏–ø –∫—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª—å–∫–∞"], "correct": 1, "explanation": "–í–µ—Ä–Ω–æ! –ë–ª–æ–∫—á–µ–π–Ω ‚Äî —ç—Ç–æ —Ü–µ–ø–æ—á–∫–∞ –±–ª–æ–∫–æ–≤, –≥–¥–µ –∫–∞–∂–¥—ã–π –±–ª–æ–∫ —Å–≤—è–∑–∞–Ω —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º, —Å–æ–∑–¥–∞–≤–∞—è –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—É—é –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π."},
        {"question": "–ö–∞–∫–æ–µ –∏–∑ —ç—Ç–∏—Ö —Å–≤–æ–π—Å—Ç–≤ –ù–ï –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º?", "options": ["–î–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è", "–ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞", "–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π", "–ó–∞—â–∏—Ç–∞ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π"], "correct": 1, "explanation": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç—Å—è –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏ –∏–ª–∏ –±–∞–Ω–∫–∞–º–∏."}
    ],
    2: [
        {"question": "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á?", "options": ["–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤", "–ü–∞—Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥—Ä—É–∑—å—è–º", "–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ—à–µ–ª—å–∫—É", "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –≤—Ö–æ–¥–∞"], "correct": 2, "explanation": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á ‚Äî —ç—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ù–ò–ö–û–ú–£ –Ω–µ–ª—å–∑—è –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å. –û–Ω –¥–∞—ë—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–æ—à–µ–ª—å–∫—É."},
        {"question": "–ß—Ç–æ —Ç–∞–∫–æ–µ seed-—Ñ—Ä–∞–∑–∞?", "options": ["–ù–∞–±–æ—Ä –∏–∑ 12-24 —Å–ª–æ–≤ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞", "–ü–∞—Ä–æ–ª—å –æ—Ç –±–∏—Ä–∂–∏", "–ù–æ–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞", "–ö–æ–¥ –¥–ª—è –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"], "correct": 0, "explanation": "–í–µ—Ä–Ω–æ! Seed-—Ñ—Ä–∞–∑–∞ (—Å–∏–¥-—Ñ—Ä–∞–∑–∞) ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä —Å–ª–æ–≤ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ—à–µ–ª—å–∫—É. –•—Ä–∞–Ω–∏—Ç–µ –µ—ë –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ!"},
        {"question": "–ö–∞–∫–æ–π —Ç–∏–ø –∫–æ—à–µ–ª—å–∫–∞ —Å–∞–º—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö —Å—É–º–º?", "options": ["–ì–æ—Ä—è—á–∏–π –∫–æ—à–µ–ª—ë–∫ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ", "–ö–æ—à–µ–ª—ë–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ", "–ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–π (—Ö–æ–ª–æ–¥–Ω—ã–π) –∫–æ—à–µ–ª—ë–∫", "–ö–æ—à–µ–ª—ë–∫ –Ω–∞ –±–∏—Ä–∂–µ"], "correct": 2, "explanation": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏ (—Ö–æ–ª–æ–¥–Ω—ã–µ) —Ö—Ä–∞–Ω—è—Ç –∫–ª—é—á–∏ –æ—Ñ–ª–∞–π–Ω, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö —Å–∞–º—ã–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å—É–º–º."}
    ],
    3: [
        {"question": "–ß—Ç–æ —Ç–∞–∫–æ–µ KYC –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫—Ä–∏–ø—Ç–æ–±–∏—Ä–∂?", "options": ["–ó–Ω–∞–π —Å–≤–æ–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏", "–ö—É–ø–∏ —Å–≤–æ—é –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É", "–ö–ª—é—á–µ–≤–∞—è –≤–∞–ª—é—Ç–∞ –≥–æ–¥–∞", "–ö–æ–º–∏—Å—Å–∏—è –∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é"], "correct": 0, "explanation": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! KYC (Know Your Customer) ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–∏—á–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—É—é —Ç—Ä–µ–±—É—é—Ç –±–∏—Ä–∂–∏ –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞."},
        {"question": "–ß—Ç–æ —Ç–∞–∫–æ–µ P2P-—Ç–æ—Ä–≥–æ–≤–ª—è?", "options": ["–¢–æ—Ä–≥–æ–≤–ª—è –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –Ω–∞–ø—Ä—è–º—É—é", "–¢–æ—Ä–≥–æ–≤–ª—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±–∞–Ω–∫–∏", "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è —Ä–æ–±–æ—Ç–∞–º–∏", "–¢–æ—Ä–≥–æ–≤–ª—è —Ç–æ–ª—å–∫–æ —Å –±–∏—Ä–∂–∞–º–∏"], "correct": 0, "explanation": "–í–µ—Ä–Ω–æ! P2P (peer-to-peer) ‚Äî —ç—Ç–æ –ø—Ä—è–º—ã–µ —Å–¥–µ–ª–∫–∏ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –±–µ–∑ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–≤."},
        {"question": "–ö–∞–∫–æ–π –∏–∑ —ç—Ç–∏—Ö —Å–ø–æ—Å–æ–±–æ–≤ –ù–ï —É–ø–æ–º—è–Ω—É—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã?", "options": ["–ö—Ä–∏–ø—Ç–æ–±–∏—Ä–∂–∏", "–ö—Ä–∏–ø—Ç–æ–º–∞—Ç—ã", "–û–±–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã", "–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∞–º–∏"], "correct": 3, "explanation": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –í —É—Ä–æ–∫–µ —É–ø–æ–º—è–Ω—É—Ç—ã: –∫—Ä–∏–ø—Ç–æ–±–∏—Ä–∂–∏, P2P-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –∫—Ä–∏–ø—Ç–æ–º–∞—Ç—ã –∏ –æ–±–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã."}
    ],
    4: [
        {"question": "–ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è?", "options": ["–ß—Ç–æ–±—ã –≤–ª–æ–∂–∏—Ç—å –≤—Å—ë –≤ –æ–¥–∏–Ω –∞–∫—Ç–∏–≤", "–ß—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å —Ä–∏—Å–∫–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π", "–ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ —Ä–∞–∑–±–æ–≥–∞—Ç–µ—Ç—å", "–ß—Ç–æ–±—ã –Ω–µ –ø–ª–∞—Ç–∏—Ç—å –Ω–∞–ª–æ–≥–∏"], "correct": 1, "explanation": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫–∏ ‚Äî –µ—Å–ª–∏ –æ–¥–∏–Ω –∞–∫—Ç–∏–≤ —É–ø–∞–¥—ë—Ç, –¥—Ä—É–≥–∏–µ –º–æ–≥—É—Ç –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–µ—Ä–∏."},
        {"question": "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–æ '–Ω–µ –∫–ª–∞—Å—Ç—å –≤—Å–µ —è–π—Ü–∞ –≤ –æ–¥–Ω—É –∫–æ—Ä–∑–∏–Ω—É'?", "options": ["–î–µ—Ä–∂–∞—Ç—å –≤—Å–µ –¥–µ–Ω—å–≥–∏ –≤ –±–∞–Ω–∫–µ", "–†–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∞–∫—Ç–∏–≤–∞–º–∏", "–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –∞–∫—Ü–∏–∏", "–•—Ä–∞–Ω–∏—Ç—å –≤—Å—ë –≤ –∫—Ä–∏–ø—Ç–µ"], "correct": 1, "explanation": "–í–µ—Ä–Ω–æ! –≠—Ç–æ –∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø–æ–≥–æ–≤–æ—Ä–∫–∞ –æ–± –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è—Ö: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∞–∫—Ç–∏–≤–∞–º–∏."},
        {"question": "–ö–∞–∫–æ–π –∏–∑ —ç—Ç–∏—Ö –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π –ª—É—á—à–µ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω?", "options": ["100% –≤ TON", "70% TON, 30% SPW", "50% TON, 30% SPW, 10% BTC, 10% USDT", "90% TON, 10% USDT"], "correct": 2, "explanation": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ü–æ—Ä—Ç—Ñ–µ–ª—å —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –∞–∫—Ç–∏–≤–æ–≤ (TON, SPW, BTC, USDT) –ª—É—á—à–µ –∑–∞—â–∏—â—ë–Ω –æ—Ç —Ä–∏—Å–∫–æ–≤."}
    ],
    5: [
        {"question": "–ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–µ–π–±–ª–∫–æ–∏–Ω?", "options": ["–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ —Å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º –∫—É—Ä—Å–æ–º", "–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–∞—è –∫ —Ñ–∏–∞—Ç–Ω—ã–º –¥–µ–Ω—å–≥–∞–º", "–¢–æ–∫–µ–Ω –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π", "–ê–∫—Ü–∏—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏"], "correct": 1, "explanation": "–í–µ—Ä–Ω–æ! –°—Ç–µ–π–±–ª–∫–æ–∏–Ω—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Ñ–∏–∞—Ç–Ω—ã–º –≤–∞–ª—é—Ç–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, USDT –∫ –¥–æ–ª–ª–∞—Ä—É) –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏."},
        {"question": "–ì–¥–µ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –≤—Å–µ–≥–æ —Ö—Ä–∞–Ω–∏—Ç—å seed-—Ñ—Ä–∞–∑—É?", "options": ["–í –æ–±–ª–∞—á–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ", "–ù–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞", "–í –∑–∞–º–µ—Ç–∫–∞—Ö –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ", "–ù–∞ –±—É–º–∞–≥–µ –≤ —Å–µ–π—Ñ–µ"], "correct": 3, "explanation": "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! Seed-—Ñ—Ä–∞–∑—É –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –æ—Ñ–ª–∞–π–Ω, –Ω–∞ –±—É–º–∞–≥–µ –∏–ª–∏ –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–æ–π –ø–ª–∞—Å—Ç–∏–Ω–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ."},
        {"question": "–ß—Ç–æ —Ç–∞–∫–æ–µ 2FA (–¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)?", "options": ["–î–≤–∞ –ø–∞—Ä–æ–ª—è –¥–ª—è –≤—Ö–æ–¥–∞", "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", "–î–≤–∞ –∫–æ—à–µ–ª—å–∫–∞ –Ω–∞ –æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç", "–î–≤–∞ —Ç–∏–ø–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã"], "correct": 1, "explanation": "–í–µ—Ä–Ω–æ! 2FA –¥–æ–±–∞–≤–ª—è–µ—Ç –≤—Ç–æ—Ä–æ–π —à–∞–≥ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) –¥–ª—è –∑–∞—â–∏—Ç—ã –∞–∫–∫–∞—É–Ω—Ç–∞."}
    ]
}

print(f"‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: {len(LESSONS)} —É—Ä–æ–∫–æ–≤, {len(QUIZZES)} —Ç–µ—Å—Ç–æ–≤")

# –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏
user_quiz_attempts = {}

# =========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –õ–û–ö–ê–õ–¨–ù–û–ô –ë–ê–ó–û–ô ===========

async def get_user_progress(user_id: int):
    """–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    try:
        if HAS_DATABASE:
            # –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –ø–æ telegram_id
            user_row = local_db.fetch_one(
                "SELECT id, spw_balance FROM users WHERE telegram_id = ?",
                (str(user_id),)
            )
            
            if user_row:
                db_user_id = user_row[0]
                user_spw_balance = user_row[1]
                
                # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                lessons_rows = local_db.fetch_all(
                    """SELECT lesson_id, quiz_score, completed_at, reward_granted 
                       FROM user_lessons 
                       WHERE user_id = ?""",
                    (db_user_id,)
                )
                
                completed_lessons = []
                total_rewards = 0
                
                for row in lessons_rows:
                    lesson_id = row[0]
                    reward_granted = row[3]
                    completed_lessons.append(lesson_id)
                    
                    # –ù–∞—Ö–æ–¥–∏–º —É—Ä–æ–∫ –≤ —Å–ø–∏—Å–∫–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã
                    lesson_data = next((l for l in LESSONS if l['id'] == lesson_id), None)
                    if lesson_data and reward_granted:
                        total_rewards += lesson_data['reward_spw']
                
                return {
                    "completed": completed_lessons,
                    "rewards": total_rewards,
                    "db_user_id": db_user_id,
                    "spw_balance": user_spw_balance
                }
            else:
                # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ
                try:
                    local_db.execute_query(
                        """INSERT INTO users (telegram_id, spw_balance) 
                           VALUES (?, 0)""",
                        (str(user_id),)
                    )
                    print(f"‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ: {user_id}")
                    
                    # –ü–æ–ª—É—á–∞–µ–º ID –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    new_user_row = local_db.fetch_one(
                        "SELECT id FROM users WHERE telegram_id = ?",
                        (str(user_id),)
                    )
                    
                    if new_user_row:
                        return {
                            "completed": [],
                            "rewards": 0,
                            "db_user_id": new_user_row[0],
                            "spw_balance": 0
                        }
                except Exception as e:
                    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {e}")
        
        # –ï—Å–ª–∏ –±–∞–∑–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞
        return {"completed": [], "rewards": 0, "db_user_id": None, "spw_balance": 0}
        
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}: {e}")
        return {"completed": [], "rewards": 0, "db_user_id": None, "spw_balance": 0}

async def save_lesson_result(user_id: int, lesson_id: int, quiz_score: int, reward_spw: int):
    """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —É—Ä–æ–∫–∞ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
    try:
        if not HAS_DATABASE:
            logger.warning("–õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω")
            return False
        
        # –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        progress = await get_user_progress(user_id)
        db_user_id = progress["db_user_id"]
        
        if not db_user_id:
            logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å/—Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")
            return False
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –∑–∞–ø–∏—Å—å –æ–± —ç—Ç–æ–º —É—Ä–æ–∫–µ
        existing_row = local_db.fetch_one(
            "SELECT id FROM user_lessons WHERE user_id = ? AND lesson_id = ?",
            (db_user_id, lesson_id)
        )
        
        if existing_row:
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å
            local_db.execute_query(
                """UPDATE user_lessons 
                   SET quiz_score = ?, completed_at = CURRENT_TIMESTAMP, reward_granted = TRUE
                   WHERE id = ?""",
                (quiz_score, existing_row[0])
            )
            logger.info(f"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Ä–æ–∫–∞ {lesson_id} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")
        else:
            # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
            local_db.execute_query(
                """INSERT INTO user_lessons (user_id, lesson_id, quiz_score, reward_granted)
                   VALUES (?, ?, ?, TRUE)""",
                (db_user_id, lesson_id, quiz_score)
            )
            logger.info(f"‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Ä–æ–∫–∞ {lesson_id} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å SPW –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        try:
            current_balance = progress.get("spw_balance", 0)
            new_balance = current_balance + reward_spw
            
            local_db.execute_query(
                "UPDATE users SET spw_balance = ? WHERE id = ?",
                (new_balance, db_user_id)
            )
            
            logger.info(f"üí∞ –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ {reward_spw} SPW (–Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: {new_balance})")
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞: {e}")
            return False
        
        return True
        
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —É—Ä–æ–∫–∞: {e}")
        return False

# =========== –û–°–¢–ê–í–®–ò–ï–°–Ø –§–£–ù–ö–¶–ò–ò (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô) ===========

async def show_lessons_progress(user_id: int, chat_id: int, bot=None, message=None, edit_message=False):
    """–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è"""
    # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    progress = await get_user_progress(user_id)
    completed = progress["completed"]
    earned = progress["rewards"]
    total_rewards = sum(lesson["reward_spw"] for lesson in LESSONS)
    spw_balance = progress.get("spw_balance", 0)
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    text = f"""üéì **–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ä–æ–∫–∏**

üìä –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å:
‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤: {len(completed)}/{len(LESSONS)}
üèÜ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ SPW: {earned}/{total_rewards}
üí∞ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: {spw_balance} SPW
üéÅ –î–æ—Å—Ç—É–ø–Ω–æ –∫ –ø–æ–ª—É—á–µ–Ω–∏—é: {total_rewards - earned} SPW

üìö **–°–ø–∏—Å–æ–∫ —É—Ä–æ–∫–æ–≤:**
"""
    
    for lesson in LESSONS:
        status = "‚úÖ" if lesson["id"] in completed else "üìò"
        text += f"\n{status} –£—Ä–æ–∫ {lesson['id']}: {lesson['title']} ({lesson['reward_spw']} SPW)"
    
    if len(completed) == len(LESSONS):
        text += "\n\nüéâ **–í–´ –ó–ê–í–ï–†–®–ò–õ–ò –í–°–ï –£–†–û–ö–ò!** üéâ"
        text += f"\nüèÜ –ò—Ç–æ–≥–æ–≤–∞—è –Ω–∞–≥—Ä–∞–¥–∞: {earned} SPW"
        text += "\nüí° –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø—Ä–æ—à–ª–∏ –ø–æ–ª–Ω—ã–π –∫—É—Ä—Å –æ—Å–Ω–æ–≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç."
    else:
        next_lesson = next((l for l in LESSONS if l["id"] not in completed), None)
        if next_lesson:
            text += f"\n\nüéØ **–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫:** –£—Ä–æ–∫ {next_lesson['id']}: {next_lesson['title']}"
            text += f"\nüéÅ –ù–∞–≥—Ä–∞–¥–∞: {next_lesson['reward_spw']} SPW"
    
    text += "\n\n–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:"
    
    # –°–æ–∑–¥–∞—ë–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    keyboard = InlineKeyboardMarkup(inline_keyboard=[])
    
    # –ö–Ω–æ–ø–∫–∏ –¥–ª—è –Ω–µ–ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤
    for lesson in LESSONS:
        if lesson["id"] not in completed:
            keyboard.inline_keyboard.append([
                InlineKeyboardButton(
                    text=f"üìö –£—Ä–æ–∫ {lesson['id']}: {lesson['title'][:30]}...",
                    callback_data=f"show_lesson_{lesson['id']}"
                )
            ])
    
    # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤
    if completed:
        keyboard.inline_keyboard.append([
            InlineKeyboardButton(
                text="üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏",
                callback_data="review_lessons"
            )
        ])
    
    # –ï—Å–ª–∏ –≤—Å–µ —É—Ä–æ–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
    if len(completed) == len(LESSONS):
        keyboard.inline_keyboard.append([
            InlineKeyboardButton(
                text="üèÜ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏",
                callback_data="certificate"
            )
        ])
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    if edit_message and message:
        await message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
    elif bot:
        await bot.send_message(chat_id, text, reply_markup=keyboard, parse_mode="Markdown")
    elif message:
        await message.answer(text, reply_markup=keyboard, parse_mode="Markdown")

# =========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î –ò CALLBACK ===========

@router.message(Command("learn"))
async def cmd_learn(message: types.Message):
    """–ö–æ–º–∞–Ω–¥–∞ /learn - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è"""
    await show_lessons_progress(
        user_id=message.from_user.id,
        chat_id=message.chat.id,
        message=message
    )

@router.callback_query(lambda c: c.data.startswith("show_lesson_"))
async def show_lesson(callback: types.CallbackQuery):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —É—Ä–æ–∫"""
    lesson_id = int(callback.data.split("_")[-1])
    lesson = next((l for l in LESSONS if l["id"] == lesson_id), None)
    
    if not lesson:
        await callback.answer("–£—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω", show_alert=True)
        return
    
    text = f"""üéì **–£—Ä–æ–∫ {lesson['id']}: {lesson['title']}**

{lesson['content']}

‚è± –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {lesson['duration_minutes']} –º–∏–Ω—É—Ç
üéÅ –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ: {lesson['reward_spw']} SPW

üí° –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª, –∑–∞—Ç–µ–º –ø—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π.
"""
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [
            InlineKeyboardButton(
                text="üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç (3 –≤–æ–ø—Ä–æ—Å–∞)",
                callback_data=f"start_quiz_{lesson_id}"
            )
        ],
        [
            InlineKeyboardButton(
                text="üìö –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —É—Ä–æ–∫–∞–º",
                callback_data="back_to_lessons"
            )
        ]
    ])
    
    await callback.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
    await callback.answer()

# =========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –¢–ï–°–¢–û–í (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô) ===========

@router.callback_query(lambda c: c.data.startswith("start_quiz_"))
async def start_quiz(callback: types.CallbackQuery):
    """–ù–∞—á–∏–Ω–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ —É—Ä–æ–∫–∞"""
    lesson_id = int(callback.data.split("_")[-1])
    user_id = callback.from_user.id
    user_id_str = str(user_id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞
    quiz_questions = QUIZZES.get(lesson_id)
    if not quiz_questions:
        await callback.answer("–¢–µ—Å—Ç –¥–ª—è —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω", show_alert=True)
        return
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    user_quiz_attempts[user_id_str] = {
        "lesson_id": lesson_id,
        "current_question": 0,
        "correct_answers": 0,
        "total_questions": len(quiz_questions),
        "questions": quiz_questions,
        "completed": False,
        "answers": []
    }
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
    await show_quiz_question(callback.message, user_id_str, lesson_id, 0)
    await callback.answer()

async def show_quiz_question(message: types.Message, user_id_str: str, lesson_id: int, question_index: int):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–æ–ø—Ä–æ—Å —Ç–µ—Å—Ç–∞"""
    quiz_state = user_quiz_attempts.get(user_id_str)
    
    if not quiz_state or quiz_state["lesson_id"] != lesson_id:
        await message.answer("‚ùå –û—à–∏–±–∫–∞: —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Å—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
        return
    
    quiz_questions = quiz_state["questions"]
    
    if question_index >= len(quiz_questions):
        await message.answer("‚ùå –û—à–∏–±–∫–∞: –≤–æ–ø—Ä–æ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return
    
    question_data = quiz_questions[question_index]
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞
    text = f"""üìù **–¢–µ—Å—Ç. –í–æ–ø—Ä–æ—Å {question_index + 1}/{len(quiz_questions)}**

‚ùì {question_data['question']}

–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤:
"""
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
    for i, option in enumerate(question_data['options']):
        text += f"\n{i+1}. {option}"
    
    text += "\n\n–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:"
    
    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤
    keyboard = InlineKeyboardMarkup(inline_keyboard=[])
    
    # –†–∞–∑–±–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –ø–æ 2 –∫–Ω–æ–ø–∫–∏
    row = []
    for i in range(len(question_data['options'])):
        row.append(
            InlineKeyboardButton(
                text=f"{i+1}",
                callback_data=f"quiz_answer_{lesson_id}_{question_index}_{i}"
            )
        )
        if len(row) == 2 or i == len(question_data['options']) - 1:
            keyboard.inline_keyboard.append(row)
            row = []
    
    # –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã
    keyboard.inline_keyboard.append([
        InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ—Å—Ç", callback_data="cancel_quiz")
    ])
    
    await message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")

@router.callback_query(lambda c: c.data.startswith("quiz_answer_"))
async def handle_quiz_answer(callback: types.CallbackQuery):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å —Ç–µ—Å—Ç–∞"""
    user_id = callback.from_user.id
    user_id_str = str(user_id)
    
    # –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ callback
    parts = callback.data.split("_")
    lesson_id = int(parts[2])
    question_index = int(parts[3])
    selected_option = int(parts[4])
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Å—Ç–∞
    quiz_state = user_quiz_attempts.get(user_id_str)
    if not quiz_state or quiz_state["lesson_id"] != lesson_id:
        await callback.answer("–û—à–∏–±–∫–∞: —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Å—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ", show_alert=True)
        return
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å–∞
    quiz_questions = quiz_state["questions"]
    if question_index >= len(quiz_questions):
        await callback.answer("–û—à–∏–±–∫–∞: –≤–æ–ø—Ä–æ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω", show_alert=True)
        return
    
    question_data = quiz_questions[question_index]
    is_correct = (selected_option == question_data['correct'])
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
    quiz_state["answers"].append({
        "question_index": question_index,
        "selected": selected_option,
        "correct": question_data['correct'],
        "is_correct": is_correct
    })
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
    if is_correct:
        quiz_state["correct_answers"] += 1
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
    emoji = "‚úÖ" if is_correct else "‚ùå"
    text = f"""{emoji} **–í–∞—à –æ—Ç–≤–µ—Ç: {'–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π' if is_correct else '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π'}**

‚ùì –í–æ–ø—Ä–æ—Å: {question_data['question']}
üìù –í–∞—à –≤—ã–±–æ—Ä: {selected_option + 1}. {question_data['options'][selected_option]}
üéØ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {question_data['correct'] + 1}. {question_data['options'][question_data['correct']]}

üí° {question_data['explanation']}
"""
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≤–µ—Ä—à–µ–Ω –ª–∏ —Ç–µ—Å—Ç
    quiz_state["current_question"] = question_index + 1
    
    if quiz_state["current_question"] >= quiz_state["total_questions"]:
        # –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω
        quiz_state["completed"] = True
        await finish_quiz(callback.message, user_id_str, lesson_id)
    else:
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
        text += f"\n\nüìä –ü—Ä–æ–≥—Ä–µ—Å—Å: {quiz_state['correct_answers']}/{quiz_state['current_question']} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤"
        text += f"\n\n‚û°Ô∏è **–°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å:**"
        
        keyboard = InlineKeyboardMarkup(inline_keyboard=[[
            InlineKeyboardButton(
                text="‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–µ—Å—Ç",
                callback_data=f"next_question_{lesson_id}_{quiz_state['current_question']}"
            )
        ]])
        
        await callback.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
    
    await callback.answer()

@router.callback_query(lambda c: c.data.startswith("next_question_"))
async def next_question(callback: types.CallbackQuery):
    """–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É"""
    parts = callback.data.split("_")
    lesson_id = int(parts[2])
    question_index = int(parts[3])
    
    user_id_str = str(callback.from_user.id)
    
    await show_quiz_question(callback.message, user_id_str, lesson_id, question_index)
    await callback.answer()

async def finish_quiz(message: types.Message, user_id_str: str, lesson_id: int):
    """–ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"""
    quiz_state = user_quiz_attempts.get(user_id_str)
    
    if not quiz_state or not quiz_state["completed"]:
        await message.answer("‚ùå –¢–µ—Å—Ç –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω")
        return
    
    correct_answers = quiz_state["correct_answers"]
    total_questions = quiz_state["total_questions"]
    quiz_score = int((correct_answers / total_questions) * 100)
    passed = quiz_score >= 70
    
    text = f"""üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞**

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {correct_answers}/{total_questions}
üìà –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: {quiz_score}%
üéØ –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è: 70%
"""
    
    if passed:
        text += f"\nüéâ **–¢–ï–°–¢ –ü–†–û–ô–î–ï–ù!** üéâ"
        
        # –ù–∞—Ö–æ–¥–∏–º —É—Ä–æ–∫
        lesson = next((l for l in LESSONS if l["id"] == lesson_id), None)
        
        if lesson:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —ç—Ç–æ—Ç —É—Ä–æ–∫
            user_id = int(user_id_str)
            progress = await get_user_progress(user_id)
            
            if lesson_id not in progress["completed"]:
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
                success = await save_lesson_result(
                    user_id=user_id,
                    lesson_id=lesson_id,
                    quiz_score=quiz_score,
                    reward_spw=lesson["reward_spw"]
                )
                
                if success:
                    text += f"\n\nüèÜ –í—ã –ø–æ–ª—É—á–∏–ª–∏: {lesson['reward_spw']} SPW"
                    text += f"\nüìö –£—Ä–æ–∫ '{lesson['title']}' —Ç–µ–ø–µ—Ä—å –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π!"
                    text += f"\nüíæ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"
                else:
                    text += f"\n\n‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –ù–∞–≥—Ä–∞–¥–∞ –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∞."
            else:
                text += f"\n\n‚ÑπÔ∏è –í—ã —É–∂–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —ç—Ç–æ—Ç —É—Ä–æ–∫ —Ä–∞–Ω–µ–µ."
        
        # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Å—Ç–∞
        if user_id_str in user_quiz_attempts:
            del user_quiz_attempts[user_id_str]
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ —É—Ä–æ–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
        user_id = int(user_id_str)
        progress = await get_user_progress(user_id)
        if len(progress["completed"]) == len(LESSONS):
            text += "\n\nüéä **–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –í–´ –ó–ê–í–ï–†–®–ò–õ–ò –í–°–ï –£–†–û–ö–ò!** üéä"
        
        keyboard = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üìö –ö —Å–ø–∏—Å–∫—É —É—Ä–æ–∫–æ–≤", callback_data="back_to_lessons")]
        ])
    else:
        text += f"\n‚ùå **–¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù**"
        text += f"\n\n–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ –Ω—É–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º –Ω–∞ 70% –≤–æ–ø—Ä–æ—Å–æ–≤."
        text += f"\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏–≤ –º–∞—Ç–µ—Ä–∏–∞–ª —É—Ä–æ–∫–∞."
        
        keyboard = InlineKeyboardMarkup(inline_keyboard=[
            [
                InlineKeyboardButton(text="üîÑ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –µ—â–µ —Ä–∞–∑", callback_data=f"start_quiz_{lesson_id}"),
                InlineKeyboardButton(text="üìñ –ü–µ—Ä–µ—á–∏—Ç–∞—Ç—å —É—Ä–æ–∫", callback_data=f"show_lesson_{lesson_id}")
            ],
            [InlineKeyboardButton(text="üìö –ö —Å–ø–∏—Å–∫—É —É—Ä–æ–∫–æ–≤", callback_data="back_to_lessons")]
        ])
    
    await message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")

@router.callback_query(lambda c: c.data == "cancel_quiz")
async def cancel_quiz(callback: types.CallbackQuery):
    """–û—Ç–º–µ–Ω—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"""
    user_id = str(callback.from_user.id)
    
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Å—Ç–∞
    if user_id in user_quiz_attempts:
        del user_quiz_attempts[user_id]
    
    text = "‚ùå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.\n\n–í—ã –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —É—Ä–æ–∫—É –∏ –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –ø–æ–∑–∂–µ."
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[[
        InlineKeyboardButton(text="üìö –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —É—Ä–æ–∫–∞–º", callback_data="back_to_lessons")
    ]])
    
    await callback.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
    await callback.answer()

@router.callback_query(lambda c: c.data == "back_to_lessons")
async def back_to_lessons(callback: types.CallbackQuery):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ —Å–ø–∏—Å–∫—É —É—Ä–æ–∫–æ–≤"""
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Å—Ç–∞, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
    user_id = str(callback.from_user.id)
    if user_id in user_quiz_attempts:
        del user_quiz_attempts[user_id]
    
    await show_lessons_progress(
        user_id=callback.from_user.id,
        chat_id=callback.message.chat.id,
        message=callback.message,
        edit_message=True
    )
    await callback.answer()

@router.callback_query(lambda c: c.data == "review_lessons")
async def review_lessons(callback: types.CallbackQuery):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏"""
    user_id = callback.from_user.id
    progress = await get_user_progress(user_id)
    completed = progress["completed"]
    
    if not completed:
        text = "–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /learn –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—É—á–µ–Ω–∏—è!"
        keyboard = InlineKeyboardMarkup(inline_keyboard=[[
            InlineKeyboardButton(text="üìö –ö —É—Ä–æ–∫–∞–º", callback_data="back_to_lessons")
        ]])
    else:
        text = "üìö **–ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏:**\n\n"
        for lesson_id in completed:
            lesson = next((l for l in LESSONS if l["id"] == lesson_id), None)
            if lesson:
                text += f"‚úÖ –£—Ä–æ–∫ {lesson['id']}: {lesson['title']}\n"
        
        text += "\n–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:"
        
        # –°–æ–∑–¥–∞—ë–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–º–∏ —É—Ä–æ–∫–∞–º–∏
        keyboard = InlineKeyboardMarkup(inline_keyboard=[])
        for lesson_id in completed:
            lesson = next((l for l in LESSONS if l["id"] == lesson_id), None)
            if lesson:
                keyboard.inline_keyboard.append([
                    InlineKeyboardButton(
                        text=f"üìñ –£—Ä–æ–∫ {lesson['id']}: {lesson['title'][:30]}...",
                        callback_data=f"show_lesson_{lesson['id']}"
                    )
                ])
        
        keyboard.inline_keyboard.append([
            InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="back_to_lessons")
        ])
    
    await callback.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
    await callback.answer()

@router.callback_query(lambda c: c.data == "certificate")
async def show_certificate(callback: types.CallbackQuery):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏"""
    user_id = callback.from_user.id
    progress = await get_user_progress(user_id)
    completed = progress["completed"]
    earned = progress["rewards"]
    
    if len(completed) == len(LESSONS):
        text = f"""üèÜ **–°–ï–†–¢–ò–§–ò–ö–ê–¢ –û–ë –û–ö–û–ù–ß–ê–ù–ò–ò**

–£–¥–æ—Å—Ç–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **{callback.from_user.first_name}**
—É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à—ë–ª –ø–æ–ª–Ω—ã–π –∫—É—Ä—Å "–û—Å–Ω–æ–≤—ã –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç" –≤ –±–æ—Ç–µ "–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ö–æ–ø–∏–ª–∫–∞".

‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤: {len(LESSONS)}/{len(LESSONS)}
üèÜ –ò—Ç–æ–≥–æ–≤–∞—è –Ω–∞–≥—Ä–∞–¥–∞: {earned} SPW

üéØ **–û—Å–≤–æ–µ–Ω–Ω—ã–µ —Ç–µ–º—ã:**
‚Ä¢ –ß—Ç–æ —Ç–∞–∫–æ–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ –∏ –±–ª–æ–∫—á–µ–π–Ω
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞ –∫–æ—à–µ–ª—å–∫–æ–≤
‚Ä¢ –ü–æ–∫—É–ø–∫–∞ –∏ –ø—Ä–æ–¥–∞–∂–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
‚Ä¢ –ü—Ä–∏–Ω—Ü–∏–ø—ã –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚Ä¢ –°—Ç–µ–π–±–ª–∫–æ–∏–Ω—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

üí° **–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ö–æ–ø–∏–ª–∫–∞ –û–ú–†**
üåê openrep.world
"""
    else:
        text = "–í—ã –µ—â—ë –Ω–µ –ø—Ä–æ—à–ª–∏ –≤—Å–µ —É—Ä–æ–∫–∏. –ü—Ä–æ–π–¥–∏—Ç–µ –≤—Å–µ 5 —É—Ä–æ–∫–æ–≤, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç!"
    
    keyboard = InlineKeyboardMarkup(inline_keyboard=[[
        InlineKeyboardButton(text="üìö –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —É—Ä–æ–∫–∞–º", callback_data="back_to_lessons")
    ]])
    
    await callback.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
    await callback.answer()

# =========== –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ú–û–î–£–õ–Ø ===========

module_info = {
    "name": "–û–±—É—á–µ–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º",
    "description": "5 —É—Ä–æ–∫–æ–≤ —Å –æ—Å–Ω–æ–≤–∞–º–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞",
    "commands": {
        "/learn": "–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ (5 —É—Ä–æ–∫–æ–≤, –Ω–∞–≥—Ä–∞–¥—ã SPW, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)"
    },
    "router": router
}

register_module(module_info)

print(f"‚úÖ –ú–æ–¥—É–ª—å lessons –∑–∞–≥—Ä—É–∂–µ–Ω. –£—Ä–æ–∫–æ–≤: {len(LESSONS)}, –¢–µ—Å—Ç–æ–≤: {len(QUIZZES)}")
